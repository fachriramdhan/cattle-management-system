ARSITEKTUR SISTEM

1. POLA ARSITEKTUR: MVC (Model-View-Controller)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INTERFACE                        â”‚
â”‚                  (Browser / Client)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP Request
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ASP.NET CORE MVC                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ROUTING â”‚â”€â”€â”€â–¶â”‚CONTROLLERâ”‚â”€â”€â”€â–¶â”‚     VIEW     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                       â”‚                                  â”‚
â”‚                       â–¼                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚     MODEL      â”‚                          â”‚
â”‚              â”‚  (Entities)    â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ENTITY FRAMEWORK CORE (ORM)                   â”‚
â”‚              - DbContext                                 â”‚
â”‚              - Migration                                 â”‚
â”‚              - Change Tracking                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DATABASE (MySQL)                        â”‚
â”‚   - Sapi                - ProduksiOlahan                 â”‚
â”‚   - ProduksiSusu        - KesehatanSapi                  â”‚
â”‚   - Peternak            - JadwalKegiatan                 â”‚
â”‚   - Users (Identity)    - ActivityLogs                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

------------------------------------------------------------------------------------------------------------------------------------

ALUR KERJA SISTEM (REQUEST-RESPONSE CYCLE)
Contoh: User Menambah Data Sapi
1. USER ACTION
   â””â”€ User mengisi form "Tambah Sapi" dan klik tombol "Simpan"

2. BROWSER
   â””â”€ Mengirim HTTP POST request ke: /Sapi/Create
      Body: { KodeSapi: "SP-001", NamaSapi: "Bella", ... }

3. ROUTING
   â””â”€ ASP.NET Core routing mencocokkan URL dengan Controller & Action
      URL: /Sapi/Create â†’ SapiController.Create()

4. CONTROLLER
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SapiController.Create(Sapi sapi)                    â”‚
   â”‚                                                      â”‚
   â”‚ A. VALIDASI                                          â”‚
   â”‚    if (ModelState.IsValid) { ... }                  â”‚
   â”‚                                                      â”‚
   â”‚ B. BUSINESS LOGIC                                    â”‚
   â”‚    - Set UserId = current logged in user            â”‚
   â”‚    - sapi.UserId = userId;                          â”‚
   â”‚                                                      â”‚
   â”‚ C. DATABASE OPERATION                                â”‚
   â”‚    - _context.Add(sapi);                            â”‚
   â”‚    - await _context.SaveChangesAsync();             â”‚
   â”‚                                                      â”‚
   â”‚ D. AUTO AUDIT LOG (Intercepted)                     â”‚
   â”‚    - ApplicationDbContext.SaveChanges()             â”‚
   â”‚    - LogChanges() method dipanggil otomatis         â”‚
   â”‚    - Insert ke tabel ActivityLogs                   â”‚
   â”‚                                                      â”‚
   â”‚ E. REDIRECT                                          â”‚
   â”‚    - TempData["SuccessMessage"] = "Berhasil"        â”‚
   â”‚    - return RedirectToAction("Index");              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. ENTITY FRAMEWORK CORE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ A. Change Tracking                                   â”‚
   â”‚    - EF mendeteksi sapi entity baru (EntityState.Added) â”‚
   â”‚                                                      â”‚
   â”‚ B. Generate SQL                                      â”‚
   â”‚    INSERT INTO Sapi (KodeSapi, NamaSapi, ...)       â”‚
   â”‚    VALUES ('SP-001', 'Bella', ...);                 â”‚
   â”‚                                                      â”‚
   â”‚ C. Execute to Database                               â”‚
   â”‚    - Kirim query ke MySQL via Pomelo provider       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. DATABASE (MySQL)
   â””â”€ Eksekusi INSERT statement
   â””â”€ Return success/error
   â””â”€ Auto-increment ID generated

7. RESPONSE
   â””â”€ Controller redirect ke /Sapi/Index
   â””â”€ Index action menampilkan View dengan data terbaru
   â””â”€ TempData trigger SweetAlert success notification

8. BROWSER
   â””â”€ Tampilkan halaman Index Sapi
   â””â”€ Muncul popup "Data sapi berhasil ditambahkan"

------------------------------------------------------------------------------------------------------------------------------------

SISTEM AUTHENTICATION & AUTHORIZATION
Flow Login User:
1. USER SUBMIT LOGIN FORM
   â””â”€ Email: user@simsapi.com
   â””â”€ Password: User123

2. AccountController.Login(LoginViewModel model)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ A. FIND USER                                         â”‚
   â”‚    var user = await _userManager.FindByEmailAsync() â”‚
   â”‚                                                      â”‚
   â”‚ B. CHECK USER ACTIVE                                 â”‚
   â”‚    if (!user.IsActive) â†’ Reject                     â”‚
   â”‚                                                      â”‚
   â”‚ C. VERIFY PASSWORD                                   â”‚
   â”‚    var result = await _signInManager.PasswordSignInAsync() â”‚
   â”‚                                                      â”‚
   â”‚ D. CREATE AUTHENTICATION COOKIE                      â”‚
   â”‚    - ASP.NET Core Identity creates encrypted cookie â”‚
   â”‚    - Cookie contains: UserId, UserName, Roles       â”‚
   â”‚                                                      â”‚
   â”‚ E. REDIRECT TO DASHBOARD                             â”‚
   â”‚    return RedirectToAction("Index", "Dashboard");   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. SETIAP REQUEST SELANJUTNYA
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Browser mengirim Cookie di Header                    â”‚
   â”‚ â†“                                                    â”‚
   â”‚ ASP.NET Core Middleware membaca Cookie               â”‚
   â”‚ â†“                                                    â”‚
   â”‚ Decrypt & Validate Cookie                            â”‚
   â”‚ â†“                                                    â”‚
   â”‚ Set User.Identity (ClaimsPrincipal)                  â”‚
   â”‚ - User.FindFirstValue(ClaimTypes.NameIdentifier)    â”‚
   â”‚ - User.IsInRole("Admin")                            â”‚
   â”‚ â†“                                                    â”‚
   â”‚ Controller Action dapat akses User info              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

------------------------------------------------------------------------------------------------------------------------------------   

   Data Isolation (Role-based Access):

   USER ROLE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query Sapi:                                          â”‚
â”‚ var query = _context.Sapi.AsQueryable();            â”‚
â”‚                                                      â”‚
â”‚ if (!isAdmin) {                                      â”‚
â”‚     query = query.Where(s => s.UserId == userId);   â”‚
â”‚ }                                                    â”‚
â”‚                                                      â”‚
â”‚ Result:                                              â”‚
â”‚ - User hanya lihat sapi miliknya sendiri            â”‚
â”‚ - Admin lihat semua sapi dari semua user            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADMIN ROLE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query Sapi:                                          â”‚
â”‚ var query = _context.Sapi.AsQueryable();            â”‚
â”‚ // Tidak ada filter UserId                          â”‚
â”‚                                                      â”‚
â”‚ Result:                                              â”‚
â”‚ - Admin lihat SEMUA data                            â”‚
â”‚ - Bisa edit/hapus data siapa saja                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

------------------------------------------------------------------------------------------------------------------------------------

DATABASE SCHEMA & RELASI
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AspNetUsers     â”‚ (Identity - Built-in)
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Id (PK)          â”‚â”€â”€â”€â”
â”‚ Email            â”‚   â”‚
â”‚ PasswordHash     â”‚   â”‚
â”‚ NamaLengkap      â”‚   â”‚
â”‚ IsActive         â”‚   â”‚
â”‚ PeternakId (FK)  â”‚â”€â” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                     â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚    Peternak      â”‚ â”‚ â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚ Id (PK)          â”‚â—„â”˜ â”‚
â”‚ KodePeternak     â”‚   â”‚
â”‚ NamaLengkap      â”‚   â”‚
â”‚ Alamat           â”‚   â”‚
â”‚ UserId (FK)      â”‚â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚      Sapi        â”‚   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚ Id (PK)          â”‚   â”‚
â”‚ KodeSapi         â”‚   â”‚
â”‚ NamaSapi         â”‚   â”‚
â”‚ UserId (FK)      â”‚â—„â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                          â”‚                   â”‚
    â–¼                          â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ProduksiSusu  â”‚   â”‚ KesehatanSapi    â”‚  â”‚ (Sapi relation)  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Id (PK)      â”‚   â”‚ Id (PK)          â”‚
â”‚ SapiId (FK)  â”‚â”€â”€â”€â”‚ SapiId (FK)      â”‚
â”‚ VolumeLiter  â”‚   â”‚ Diagnosa         â”‚
â”‚ WaktuPerah   â”‚   â”‚ StatusKesehatan  â”‚
â”‚ Tanggal      â”‚   â”‚ BiayaPengobatan  â”‚
â”‚ UserId       â”‚   â”‚ UserId           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProduksiOlahan   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Id (PK)          â”‚
â”‚ NamaProduk       â”‚
â”‚ JenisOlahan      â”‚
â”‚ JumlahProduksi   â”‚
â”‚ HargaJual        â”‚
â”‚ UserId (FK)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JadwalKegiatan   â”‚       â”‚ PesertaKegiatan  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Id (PK)          â”‚â—„â”€â”€â”   â”‚ Id (PK)          â”‚
â”‚ NamaKegiatan     â”‚   â””â”€â”€â”€â”‚ JadwalKegiatanId â”‚
â”‚ TanggalMulai     â”‚       â”‚ UserId (FK)      â”‚
â”‚ Status           â”‚       â”‚ Hadir            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           (Many-to-Many via Junction)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ActivityLogs    â”‚ (Audit Trail)
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Id (PK)          â”‚
â”‚ UserId           â”‚
â”‚ EntityName       â”‚ (Sapi, ProduksiSusu, etc)
â”‚ Action           â”‚ (Added, Modified, Deleted)
â”‚ OldData (JSON)   â”‚
â”‚ NewData (JSON)   â”‚
â”‚ Timestamp        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

------------------------------------------------------------------------------------------------------------------------------------

SISTEM AUDIT LOG (Auto Tracking)
Cara Kerja:

// ApplicationDbContext.cs
public override async Task<int> SaveChangesAsync(...)
{
    LogChanges(); // â† Dipanggil SEBELUM save ke database
    return await base.SaveChangesAsync(cancellationToken);
}

private void LogChanges()
{
    var userId = _httpContextAccessor.HttpContext.User
        .FindFirstValue(ClaimTypes.NameIdentifier);

    // Ambil semua entity yang berubah
    var entries = ChangeTracker.Entries()
        .Where(e => e.Entity is Sapi || e.Entity is ProduksiSusu)
        .Where(e => e.State == EntityState.Added || 
                   e.State == EntityState.Modified || 
                   e.State == EntityState.Deleted);

    foreach (var entry in entries)
    {
        var log = new ActivityLog
        {
            UserId = userId,
            EntityName = entry.Entity.GetType().Name,
            Action = entry.State.ToString(),
            Timestamp = DateTime.Now
        };

        if (entry.State == EntityState.Modified)
        {
            // Simpan data LAMA dan BARU dalam JSON
            log.OldData = JsonConvert.SerializeObject(entry.OriginalValues);
            log.NewData = JsonConvert.SerializeObject(entry.CurrentValues);
        }
        
        ActivityLogs.Add(log);
    }
}


CONTOH LOG ENTRY:
{
  "Id": 1,
  "UserId": "abc123",
  "EntityName": "Sapi",
  "Action": "Modified",
  "OldData": "{\"NamaSapi\":\"Bella\",\"StatusSapi\":\"Aktif\"}",
  "NewData": "{\"NamaSapi\":\"Bella\",\"StatusSapi\":\"Sakit\"}",
  "Timestamp": "2026-01-12 10:30:00"
}
```

---

## ğŸ“„ SISTEM LAPORAN PDF (QuestPDF)

### **Flow Generate PDF:**
```
1. USER KLIK "GENERATE PDF"
   â””â”€ Form: StartDate = 01/01/2026, EndDate = 31/01/2026

2. ReportController.GeneratePDF(startDate, endDate)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ A. QUERY DATA                                        â”‚
   â”‚    var data = await _context.ProduksiSusu           â”‚
   â”‚        .Include(p => p.Sapi)                        â”‚
   â”‚        .Where(p => p.Tanggal >= startDate &&        â”‚
   â”‚                   p.Tanggal <= endDate)             â”‚
   â”‚        .ToListAsync();                              â”‚
   â”‚                                                      â”‚
   â”‚ B. CALL REPORT SERVICE                               â”‚
   â”‚    var pdfBytes = _reportService                    â”‚
   â”‚        .GenerateProduksiReport(data, ...);          â”‚
   â”‚                                                      â”‚
   â”‚ C. RETURN FILE                                       â”‚
   â”‚    return File(pdfBytes, "application/pdf", ...);   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. ReportService.GenerateProduksiReport(...)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ QuestPDF Fluent API:                                 â”‚
   â”‚                                                      â”‚
   â”‚ Document.Create(container => {                       â”‚
   â”‚     container.Page(page => {                         â”‚
   â”‚         page.Header() â†’ Judul Laporan               â”‚
   â”‚         page.Content() â†’ Tabel Data                 â”‚
   â”‚         page.Footer() â†’ Nomor Halaman               â”‚
   â”‚     });                                             â”‚
   â”‚ });                                                  â”‚
   â”‚                                                      â”‚
   â”‚ return document.GeneratePdf();                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. BROWSER
   â””â”€ Download file: Laporan_Produksi_20260101_20260131.pdf
```

---

## ğŸ—“ï¸ SISTEM JADWAL KEGIATAN

### **Flow Pendaftaran Kegiatan:**
```
1. USER MELIHAT JADWAL
   â””â”€ /JadwalKegiatan/Details/5

2. USER KLIK "DAFTAR KEGIATAN"
   â””â”€ POST: /JadwalKegiatan/Daftar/5

3. JadwalKegiatanController.Daftar(id)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ A. CEK SUDAH DAFTAR?                                 â”‚
   â”‚    var sudahDaftar = await _context.PesertaKegiatan â”‚
   â”‚        .AnyAsync(p => p.JadwalKegiatanId == id &&   â”‚
   â”‚                     p.UserId == userId);            â”‚
   â”‚                                                      â”‚
   â”‚ B. JIKA BELUM, INSERT                                â”‚
   â”‚    var peserta = new PesertaKegiatan {              â”‚
   â”‚        JadwalKegiatanId = id,                       â”‚
   â”‚        UserId = userId,                             â”‚
   â”‚        Hadir = false                                â”‚
   â”‚    };                                               â”‚
   â”‚    _context.PesertaKegiatan.Add(peserta);           â”‚
   â”‚                                                      â”‚
   â”‚ C. SAVE                                              â”‚
   â”‚    await _context.SaveChangesAsync();               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. ADMIN KELOLA KEHADIRAN
   â””â”€ Admin klik toggle "Hadir"
   â””â”€ POST: /JadwalKegiatan/Absen?id=5&userId=abc123
   â””â”€ Update: peserta.Hadir = !peserta.Hadir

------------------------------------------------------------------------------------------------------------------------------------

AUTO-UPDATE STATUS SAPI (Business Logic)
Ketika Input Kesehatan Sapi:
// KesehatanSapiController.Create()

// 1. Simpan data kesehatan
kesehatan.UserId = userId;
_context.Add(kesehatan);

// 2. Update status sapi OTOMATIS
var sapi = await _context.Sapi.FindAsync(kesehatan.SapiId);

if (kesehatan.StatusKesehatan == "Sakit" || 
    kesehatan.StatusKesehatan == "Dalam Perawatan")
{
    sapi.StatusSapi = "Sakit"; // â† Auto update
}
else if (kesehatan.StatusKesehatan == "Sembuh")
{
    sapi.StatusSapi = "Aktif"; // â† Auto update
}

await _context.SaveChangesAsync(); // Simpan keduanya sekaligus
```

---

## ğŸ¨ FRONTEND TEKNOLOGI

### **Stack yang Digunakan:**
```
1. RAZOR PAGES (.cshtml)
   - Server-side rendering
   - C# code embedded dalam HTML
   - @ syntax untuk interpolation

2. TAILWIND CSS (via CDN)
   - Utility-first CSS framework
   - Responsive design
   - No custom CSS needed

3. FONT AWESOME (via CDN)
   - Icon library
   - 1000+ icons available

4. CHART.JS (via CDN)
   - Interactive charts
   - Line, bar, pie charts

5. SWEETALERT2 (via CDN)
   - Beautiful alert dialogs
   - Confirm dialogs
```

---

## ğŸ”§ DEPLOYMENT ARCHITECTURE
```
DEVELOPMENT (MacBook Pro):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VS Code                                 â”‚
â”‚  â”œâ”€ .NET SDK 8.0                        â”‚
â”‚  â”œâ”€ C# Extension                        â”‚
â”‚  â””â”€ dotnet run (Kestrel Server)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAMP (MySQL Server)                     â”‚
â”‚  â”œâ”€ MySQL Port: 8889                    â”‚
â”‚  â”œâ”€ phpMyAdmin                          â”‚
â”‚  â””â”€ Database: db_simsapi                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PRODUCTION (Example):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Server (IIS / Nginx)                â”‚
â”‚  â””â”€ ASP.NET Core Runtime                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL Database Server                   â”‚
â”‚  â””â”€ Production Database                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š SUMMARY CARA KERJA KESELURUHAN

### **1. Ketika Aplikasi Dijalankan (`dotnet run`):**
```
A. Startup Sequence:
   1. Load Configuration (appsettings.json)
   2. Setup Dependency Injection (Services)
   3. Configure Middleware Pipeline
   4. Initialize Database Connection
   5. Seed Initial Data (Admin, Roles)
   6. Start Kestrel Web Server (Port 5000/5001)

B. Middleware Pipeline (Setiap Request):
   Request â†’ Routing â†’ Authentication â†’ Authorization â†’ Controller â†’ Response
```

### **2. User Interaction Flow:**
```
USER â†’ BROWSER â†’ HTTP REQUEST â†’ ROUTING â†’ CONTROLLER
                                              â†“
                                        BUSINESS LOGIC
                                              â†“
                                    ENTITY FRAMEWORK CORE
                                              â†“
                                          DATABASE
                                              â†“
                                   RETURN DATA TO CONTROLLER
                                              â†“
                                         RENDER VIEW
                                              â†“
                                      HTML RESPONSE
                                              â†“
                                          BROWSER
                                              â†“
                                           USER
```

### **3. Key Features Integration:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SIM-SAPI ECOSYSTEM                      â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ CRUD Sapi    â”‚    â”‚ Produksi     â”‚                  â”‚
â”‚  â”‚              â”‚â”€â”€â”€â–¶â”‚ Susu         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                    â”‚                          â”‚
â”‚         â–¼                    â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Kesehatan    â”‚    â”‚ Produksi     â”‚                  â”‚
â”‚  â”‚ Sapi         â”‚    â”‚ Olahan       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                    â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                  â–¼                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚           â”‚ Activity Log â”‚ (Auto Tracking)              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                  â”‚                                      â”‚
â”‚                  â–¼                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚           â”‚  Dashboard   â”‚ (Statistics)                 â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Jadwal       â”‚    â”‚ Laporan PDF  â”‚                  â”‚
â”‚  â”‚ Kegiatan     â”‚    â”‚ (QuestPDF)   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                          â”‚
â”‚         ALL PROTECTED BY:                               â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚         â”‚  Authentication &    â”‚                        â”‚
â”‚         â”‚  Authorization       â”‚                        â”‚
â”‚         â”‚  (ASP.NET Identity)  â”‚                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

------------------------------------------------------------------------------------------------------------------------------------

KESIMPULAN SISTEM
SIM-SAPI adalah sistem manajemen peternakan sapi yang:

âœ… Web-based - Diakses via browser
âœ… Multi-user - Admin & User dengan hak akses berbeda
âœ… Data Isolation - User hanya lihat data miliknya
âœ… Auto Audit - Semua perubahan tercatat otomatis
âœ… Responsive - Tampilan menyesuaikan device
âœ… Real-time - Data selalu up-to-date
âœ… Secure - Password hashed, role-based access
âœ… Integrated - Semua fitur saling terhubung
âœ… Reportable - Generate PDF laporan
âœ… Maintainable - Clean code, MVC pattern

------------------------------------------------------------------------------------------------------------------------------------