@model IEnumerable<SimSapi.Models.ProduksiSusu>

@{
    ViewData["Title"] = "Produksi Susu";
}

<div class="space-y-6">

<!-- ================= HEADER & FILTER ================= -->
<div class="relative bg-slate-900 border border-slate-800 rounded-2xl p-6 shadow space-y-5 overflow-hidden">

    <!-- ================= ICON SAPI (KIRI) ================= -->
    <i class="fas fa-glass-whiskey absolute left-6 top-1/2 -translate-y-1/2
              text-[180px] text-emerald-500/10
              pointer-events-none select-none"></i>

    <!-- ================= CONTENT ================= -->
    <div class="relative flex flex-col md:flex-row md:items-center md:justify-between gap-4">

        <div class="pl-2 md:pl-20">
            <h2 class="text-xl font-bold text-white">
                Produksi Susu
            </h2>
            <p class="text-slate-400 text-sm mt-1">
                Monitoring dan rekap hasil pemerahan susu
            </p>
        </div>

        <a asp-action="Create"
           class="flex items-center gap-2 bg-emerald-500/10 text-emerald-400
                  px-5 py-2 rounded-xl hover:bg-emerald-500/20 transition">
            <i class="fas fa-plus"></i>
            Tambah Produksi
        </a>
    </div>

    <!-- ================= FILTER ================= -->
    <form method="get"
          class="relative grid grid-cols-1 md:grid-cols-3 gap-3">

        <input type="date"
               name="startDate"
               value="@ViewData["StartDate"]"
               class="bg-slate-950 border border-slate-800 text-slate-200
                      rounded-xl px-4 py-2
                      focus:outline-none focus:ring-2 focus:ring-emerald-500" />

        <input type="date"
               name="endDate"
               value="@ViewData["EndDate"]"
               class="bg-slate-950 border border-slate-800 text-slate-200
                      rounded-xl px-4 py-2
                      focus:outline-none focus:ring-2 focus:ring-emerald-500" />

        <button type="submit"
                class="bg-slate-800 hover:bg-slate-700 text-white
                       rounded-xl flex items-center justify-center gap-2 transition">
            <i class="fas fa-search"></i>
            Filter
        </button>
    </form>
</div>

<!-- ================= SUMMARY ================= -->
@if (Model.Any())
{
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <div class="bg-slate-900 border border-slate-800 rounded-2xl p-5 text-center">
        <p class="text-slate-400 text-sm">Total Produksi</p>
        <p class="text-3xl font-bold text-emerald-400 mt-2">
            @Model.Sum(x => x.VolumeLiter).ToString("N2") L
        </p>
    </div>

    <div class="bg-slate-900 border border-slate-800 rounded-2xl p-5 text-center">
        <p class="text-slate-400 text-sm">Rata-rata / Hari</p>
        <p class="text-3xl font-bold text-sky-400 mt-2">
            @(Model.GroupBy(x => x.Tanggal.Date)
                .Average(g => g.Sum(x => x.VolumeLiter))
                .ToString("N2")) L
        </p>
    </div>

    <div class="bg-slate-900 border border-slate-800 rounded-2xl p-5 text-center">
        <p class="text-slate-400 text-sm">Jumlah Pemerahan</p>
        <p class="text-3xl font-bold text-white mt-2">
            @Model.Count()
        </p>
    </div>

</div>
}

<!-- ================= TABLE ================= -->
<div class="bg-slate-900 border border-slate-800 rounded-2xl shadow overflow-hidden">

    <div class="overflow-x-auto">
        <table class="w-full text-sm">

            <thead class="bg-slate-950 text-slate-400 uppercase text-xs">
                <tr>
                    <th class="px-6 py-4 text-left">Tanggal</th>
                    <th class="px-6 py-4 text-left">Kode Sapi</th>
                    <th class="px-6 py-4 text-left">Nama Sapi</th>
                    <th class="px-6 py-4 text-left">Waktu</th>
                    <th class="px-6 py-4 text-left">Volume (L)</th>
                    <th class="px-6 py-4 text-left">Aksi</th>
                </tr>
            </thead>

            <tbody class="divide-y divide-slate-800">

            @if (Model.Any())
            {
                @foreach (var item in Model)
                {
                    <tr class="hover:bg-slate-950 transition">

                        <td class="px-6 py-4 text-slate-300">
                            @item.Tanggal.ToString("dd/MM/yyyy")
                        </td>

                        <td class="px-6 py-4 text-white font-medium">
                            @item.Sapi?.KodeSapi
                        </td>

                        <td class="px-6 py-4 text-slate-200">
                            @item.Sapi?.NamaSapi
                        </td>

                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs rounded-lg
                                @(item.WaktuPerah == SimSapi.Models.WaktuPerah.Pagi
                                    ? "bg-amber-500/10 text-amber-400"
                                    : "bg-orange-500/10 text-orange-400")">
                                @item.WaktuPerah
                            </span>
                        </td>

                        <td class="px-6 py-4 font-semibold text-emerald-400">
                            @item.VolumeLiter.ToString("N2")
                        </td>

                        <td class="px-6 py-4 flex gap-4">
                            <a asp-action="Edit"
                               asp-route-id="@item.Id"
                               class="text-sky-400 hover:text-sky-300 transition">
                                <i class="fas fa-edit"></i>
                            </a>

                            <button onclick="confirmDelete(@item.Id)"
                                    class="text-red-400 hover:text-red-300 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="6" class="py-16 text-center text-slate-500">
                        <i class="fas fa-inbox text-4xl mb-3 block"></i>
                        Tidak ada data produksi susu
                    </td>
                </tr>
            }

            </tbody>
        </table>
    </div>
</div>

</div>

<!-- ================= DELETE FORM ================= -->
<form id="deleteForm" method="post" class="hidden">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
<script>
    function confirmDelete(id) {
        Swal.fire({
            title: 'Hapus Data?',
            text: 'Data yang dihapus tidak dapat dikembalikan!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#dc2626',
            cancelButtonColor: '#334155',
            confirmButtonText: 'Ya, Hapus!',
            cancelButtonText: 'Batal'
        }).then((result) => {
            if (result.isConfirmed) {
                const form = document.getElementById('deleteForm');
                form.action = '/ProduksiSusu/Delete/' + id;
                form.submit();
            }
        });
    }
</script>
}
